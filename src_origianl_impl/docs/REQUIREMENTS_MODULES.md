# 需求文档模块划分

## 🎯 **模块划分原则**

### 划分标准
- **功能独立性**: 每个模块相对独立，减少耦合
- **开发并行性**: 不同开发者可以并行开发不同模块
- **测试友好性**: 模块化便于单元测试和集成测试
- **维护便利性**: 清晰的模块边界便于维护和扩展

## 🏗️ **核心模块架构**

```
Legacy Guardians 游戏系统
├── 🎮 游戏核心模块
├── 🎨 用户界面模块
├── 🧠 AI系统模块
├── 📊 数据管理模块
├── 🔧 工具和配置模块
└── 📚 文档和测试模块
```

## 🚀 **一周开发计划 - 功能步骤划分**

### ⏰ **时间安排**
- **周一-周二**: 核心基础模块
- **周三-周四**: 功能扩展模块  
- **周五**: 界面优化模块
- **周末**: 工具和测试模块

### 🔴 **第一阶段：核心基础（周一-周二）**

#### 1. 资产管理系统 (Asset Management)
**负责人**: 待分配  
**优先级**: 🔴 高  
**依赖**: 无

##### 功能范围
- 资产类型定义和管理
- 资产权重分配算法
- 收益率计算逻辑
- 风险评估系统

##### 核心文件
- `src/components/GameArea.tsx` - 资产分配界面
- `src/hooks/useGameState.ts` - 资产状态管理
- `src/modules/assets.ts` - 资产配置
- `src/utils/game-logic.ts` - 游戏逻辑

##### 开发步骤
**Step 1 (周一上午)**: 基础资产类型定义
- [ ] 定义7种资产类型的数据结构
- [ ] 实现资产权重分配基础逻辑
- [ ] 创建资产定义模块

**Step 2 (周一下午)**: 收益率计算系统
- [ ] 实现权重总和100%验证
- [ ] 实现基础收益率计算
- [ ] 添加资产相关性处理

**Step 3 (周二)**: 风险指标和优化
- [ ] 实现波动率计算
- [ ] 实现最大回撤计算
- [ ] 添加风险提示系统

#### 2. 游戏状态管理 (Game State Management)
**负责人**: 待分配  
**优先级**: 🔴 高  
**依赖**: 无

##### 功能范围
- 全局状态管理
- 状态持久化
- 状态同步
- 状态回滚

##### 核心文件
- `src/hooks/useGameState.ts`
- `src/utils/game-logic.ts`

##### 开发步骤
**Step 1 (周一上午)**: 状态结构设计
- [ ] 设计游戏状态数据结构
- [ ] 实现基础状态管理
- [ ] 添加状态变更监听

**Step 2 (周一下午)**: 持久化实现
- [ ] 实现本地存储功能
- [ ] 添加状态恢复机制
- [ ] 实现状态回滚功能

**Step 3 (周二)**: 进度管理
- [ ] 实现游戏天数管理
- [ ] 添加等级和徽章系统
- [ ] 实现家长控制设置

### 🟡 **第二阶段：功能扩展（周三-周四）**

#### 3. 任务系统 (Task System)
**负责人**: 待分配  
**优先级**: 🟡 中  
**依赖**: 资产管理系统

##### 功能范围
- 任务生成和分配
- 任务完成条件检查
- 任务奖励系统
- 任务进度追踪

##### 核心文件
- `src/constants/tasks.json` - 任务配置
- `src/components/GameArea.tsx` - 任务显示
- `src/hooks/useGameState.ts` - 任务状态

##### 开发步骤
**Step 1 (周三上午)**: 任务基础框架
- [ ] 设计任务卡数据结构
- [ ] 实现任务生成系统
- [ ] 创建任务配置JSON

**Step 2 (周三下午)**: 任务逻辑实现
- [ ] 实现任务完成条件检查
- [ ] 添加任务奖励系统
- [ ] 实现任务难度等级

**Step 3 (周四上午)**: 任务类型扩展
- [ ] 实现分散主题任务
- [ ] 实现避险主题任务
- [ ] 实现绿色主题任务

#### 4. 市场事件系统 (Market Events)
**负责人**: 待分配  
**优先级**: 🟡 中  
**依赖**: 资产管理系统

##### 功能范围
- 随机事件生成
- 事件影响计算
- 事件选择机制
- 事件历史记录

##### 核心文件
- `src/modules/events.ts` - 事件配置
- `src/components/GameArea.tsx` - 事件显示
- `src/hooks/useGameState.ts` - 事件状态

##### 开发步骤
**Step 1 (周三上午)**: 事件基础系统
- [ ] 设计事件数据结构
- [ ] 实现随机事件生成
- [ ] 创建事件定义模块

**Step 2 (周三下午)**: 事件影响计算
- [ ] 实现事件对资产的影响
- [ ] 添加事件幅度和概率
- [ ] 实现事件历史记录

**Step 3 (周四上午)**: 事件高级功能
- [ ] 实现事件连锁反应
- [ ] 添加事件预测提示
- [ ] 优化事件平衡性

#### 5. AI伙伴系统 (AI Companion)
**负责人**: 待分配  
**优先级**: 🟡 中  
**依赖**: 聊天界面

##### 功能范围
- AI对话逻辑
- 智能建议系统
- 学习用户偏好
- 个性化反馈

##### 核心文件
- `src/constants/ai-personalities.json`
- `src/components/Modals.tsx` (AI聊天部分)

##### 开发步骤
**Step 1 (周三下午)**: AI反馈基础
- [ ] 设计AI反馈触发规则
- [ ] 实现基础反馈模板
- [ ] 创建反馈配置JSON

**Step 2 (周四上午)**: 反馈逻辑实现
- [ ] 实现低分散度提醒
- [ ] 实现高风险警告
- [ ] 实现波动日鼓励

**Step 3 (周四下午)**: AI高级功能
- [ ] 实现成就完成祝贺
- [ ] 添加个性化学习
- [ ] 优化故事化语言

#### 6. 决策训练系统 (Decision Training)
**负责人**: 待分配  
**优先级**: 🟡 中  
**依赖**: 游戏核心模块

##### 功能范围
- 决策场景生成
- 选择结果分析
- 学习进度追踪
- 个性化训练计划

##### 核心文件
- `src/hooks/useGameState.ts` (决策相关)
- `src/components/Modals.tsx` (决策弹窗)
- `src/modules/dilemmas.ts` (困境问题库)

##### 开发步骤
**Step 1 (周四下午)**: 决策场景基础
- [ ] 设计决策场景结构
- [ ] 实现场景生成系统
- [ ] 创建场景配置JSON

**Step 2 (周五上午)**: 选择分支实现
- [ ] 实现坚守/调整/探索选择
- [ ] 添加选择结果分析
- [ ] 实现学习进度追踪

**Step 3 (周五下午)**: 训练系统完善
- [ ] 实现个性化训练计划
- [ ] 添加训练难度调整
- [ ] 优化训练算法

### 🟢 **第三阶段：界面优化（周五）**

#### 7. 主界面组件 (Main UI Components)
**负责人**: 待分配  
**优先级**: 🟢 低  
**依赖**: 游戏核心模块

##### 功能范围
- 顶部状态栏
- 侧边栏信息显示
- 主游戏区域布局
- 响应式设计

##### 核心文件
- `src/components/TopBar.tsx`
- `src/components/Sidebar.tsx`
- `src/components/GameLayout.tsx`

##### 开发步骤
**Step 1 (周五上午)**: 响应式优化
- [ ] 优化移动端适配
- [ ] 实现主题切换动画
- [ ] 添加拖拽功能

**Step 2 (周五下午)**: 交互优化
- [ ] 实现键盘快捷键
- [ ] 优化用户操作流程
- [ ] 添加操作反馈

#### 8. 弹窗和模态框 (Modals & Dialogs)
**负责人**: 待分配  
**优先级**: 🟢 低  
**依赖**: 游戏核心模块

##### 功能范围
- 公司信息编辑
- AI聊天界面
- 决策选择弹窗
- 知识测验界面

##### 核心文件
- `src/components/Modals.tsx`
- 各种弹窗组件

##### 开发步骤
**Step 1 (周五上午)**: 动画优化
- [ ] 优化弹窗动画效果
- [ ] 实现弹窗堆叠管理
- [ ] 添加无障碍支持

**Step 2 (周五下午)**: 功能完善
- [ ] 实现家长控制界面
- [ ] 优化弹窗内容展示
- [ ] 添加弹窗配置选项

#### 9. 浮动功能 (Floating Features)
**负责人**: 待分配  
**优先级**: 🟢 低  
**依赖**: 游戏核心模块

##### 功能范围
- 每日转盘
- AI聊天按钮
- 快捷操作菜单

##### 核心文件
- `src/components/FloatingButtons.tsx`
- `src/modules/spinWheel.ts`

##### 开发步骤
**Step 1 (周五下午)**: 功能优化
- [ ] 优化转盘动画效果
- [ ] 添加转盘音效
- [ ] 实现快捷操作菜单

**Step 2 (周五下午)**: 交互优化
- [ ] 添加手势支持
- [ ] 优化浮动按钮布局
- [ ] 实现功能切换

### 🔧 **第四阶段：工具和测试（周末）**

#### 10. 配置管理系统 (Configuration Management)
**负责人**: 待分配  
**优先级**: 🟢 低  
**依赖**: 无

##### 功能范围
- 游戏配置管理
- 环境配置
- 用户偏好设置
- 配置验证

##### 核心文件
- `src/constants/game-config.ts`
- 各种配置文件

##### 开发步骤
**Step 1 (周六上午)**: 配置基础
- [ ] 实现配置统一管理
- [ ] 添加环境配置
- [ ] 实现配置验证

**Step 2 (周六下午)**: 配置高级功能
- [ ] 实现用户偏好设置
- [ ] 添加配置导入导出
- [ ] 实现配置热更新

#### 11. 工具函数库 (Utility Functions)
**负责人**: 待分配  
**优先级**: 🟢 低  
**依赖**: 无

##### 功能范围
- 数学计算工具
- 日期时间处理
- 数据格式化
- 验证工具

##### 核心文件
- `src/utils/game-logic.ts`
- 新增工具文件

##### 开发步骤
**Step 1 (周六)**: 基础工具
- [ ] 实现数学计算工具
- [ ] 添加日期时间处理
- [ ] 实现数据格式化

**Step 2 (周日)**: 高级工具
- [ ] 添加验证工具
- [ ] 实现性能优化工具
- [ ] 添加调试工具

#### 12. 测试系统 (Testing System)
**负责人**: 待分配  
**优先级**: 🟡 中  
**依赖**: 各功能模块

##### 功能范围
- 单元测试
- 集成测试
- E2E测试
- 测试覆盖率

##### 核心文件
- 测试配置文件
- 各模块测试文件

##### 开发步骤
**Step 1 (周六)**: 测试框架
- [ ] 设置测试框架
- [ ] 编写基础单元测试
- [ ] 实现测试覆盖率

**Step 2 (周日)**: 测试完善
- [ ] 添加集成测试
- [ ] 实现E2E测试
- [ ] 优化测试性能

## 🚀 **开发优先级矩阵**

| 模块 | 优先级 | 预估工时 | 依赖关系 | 推荐开发者 | 开发时间 |
|------|--------|----------|----------|------------|----------|
| 资产管理系统 | 🔴 高 | 40h | 无 | 核心开发者 | 周一-周二 |
| 游戏状态管理 | 🔴 高 | 32h | 无 | 核心开发者 | 周一-周二 |
| 任务系统 | 🟡 中 | 24h | 资产管理 | 功能开发者 | 周三-周四 |
| 市场事件系统 | 🟡 中 | 20h | 资产管理 | 功能开发者 | 周三-周四 |
| AI伙伴系统 | 🟡 中 | 28h | 聊天界面 | AI开发者 | 周三-周四 |
| 决策训练系统 | 🟡 中 | 24h | 游戏核心 | 功能开发者 | 周四-周五 |
| 主界面组件 | 🟢 低 | 16h | 游戏核心 | UI开发者 | 周五 |
| 弹窗模态框 | 🟢 低 | 12h | 游戏核心 | UI开发者 | 周五 |
| 浮动功能 | 🟢 低 | 8h | 游戏核心 | UI开发者 | 周五 |
| 配置管理 | 🟢 低 | 12h | 无 | 工具开发者 | 周六 |
| 工具函数库 | 🟢 低 | 16h | 无 | 工具开发者 | 周六-周日 |
| 测试系统 | 🟡 中 | 20h | 各模块 | 测试开发者 | 周六-周日 |

## 📋 **协作开发建议**

### 并行开发策略
1. **周一-周二**: 核心模块并行开发
   - 资产管理系统 + 游戏状态管理
   
2. **周三-周四**: 功能模块并行开发
   - 任务系统 + 市场事件系统 + AI伙伴系统
   
3. **周五**: 界面和功能并行开发
   - UI组件 + 决策训练系统
   
4. **周末**: 工具和测试并行开发
   - 配置管理 + 工具函数 + 测试系统

### 团队角色建议
- **核心开发者**: 负责高优先级核心模块
- **功能开发者**: 负责游戏功能模块
- **UI开发者**: 负责用户界面模块
- **AI开发者**: 负责AI相关功能
- **测试开发者**: 负责测试和质量保证
- **工具开发者**: 负责工具和配置管理

### 每日开发目标
- **周一**: 完成资产管理系统和游戏状态管理的基础框架
- **周二**: 完成核心模块的风险计算和进度管理
- **周三**: 完成任务系统和市场事件系统的基础功能
- **周四**: 完成AI伙伴系统和决策训练系统
- **周五**: 完成界面优化和交互改进
- **周六**: 完成配置管理和工具函数库
- **周日**: 完成测试系统和项目整体验证

---

*最后更新: 2024-12-19*
*更新原因: 添加一周开发计划，为每个模块划分具体的开发步骤*
