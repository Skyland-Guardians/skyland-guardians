# äº‹ä»¶ç³»ç»Ÿ (Event System)

è¿™ä¸ªäº‹ä»¶ç³»ç»Ÿä¸º Skyland Guardians æ¸¸æˆæä¾›äº†å®Œæ•´çš„ä»»åŠ¡å’Œäº‹ä»¶ç®¡ç†åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ éšæœºä»»åŠ¡ç³»ç»Ÿ
- **è§¦å‘æ¡ä»¶**: APPLYèµ„äº§é…ç½®æˆ–ä¸‹ä¸€å¤©æ—¶éšæœºè§¦å‘
- **ä»»åŠ¡ç±»å‹**: åŸºäºä¸åŒæŠ•èµ„ç­–ç•¥çš„æŒ‘æˆ˜ä»»åŠ¡
- **å¥–åŠ±æœºåˆ¶**: å®Œæˆä»»åŠ¡è·å¾—æ˜Ÿæ˜Ÿå¥–åŠ±ï¼Œæå‡ç©å®¶ç­‰çº§
- **çŠ¶æ€ç®¡ç†**: ä»»åŠ¡å¯ä»¥è¢«æ¥å—ã€æ‹’ç»æˆ–å®Œæˆ

### âš¡ å¸‚åœºäº‹ä»¶ç³»ç»Ÿ
- **éšæœºè§¦å‘**: åœ¨èµ„äº§é…ç½®æˆ–ä¸‹ä¸€å¤©æ—¶éšæœºå‡ºç°
- **å¸‚åœºå½±å“**: äº‹ä»¶ä¼šå½±å“èµ„äº§çš„è¡¨ç°å’Œæ”¶ç›Š
- **æŒç»­æ—¶é—´**: äº‹ä»¶æœ‰ä¸åŒçš„æŒç»­æ—¶é—´
- **é€‰æ‹©æœºåˆ¶**: ç©å®¶å¯ä»¥é€‰æ‹©æ¥å—æˆ–å¿½ç•¥äº‹ä»¶

### ğŸ“¦ å¡åŒ…æ”¶é›†ç³»ç»Ÿ
- **å¡ç‰‡æ”¶é›†**: æ‰€æœ‰è§¦å‘çš„äº‹ä»¶å’Œä»»åŠ¡éƒ½ä¼šä»¥å¡ç‰‡å½¢å¼å­˜å‚¨
- **çŠ¶æ€è¿½è¸ª**: æ˜¾ç¤ºå¡ç‰‡çš„çŠ¶æ€ï¼ˆè¿›è¡Œä¸­ã€å·²å®Œæˆã€å·²æ‹’ç»ï¼‰
- **å†å²è®°å½•**: ä¿å­˜ç©å®¶çš„æ‰€æœ‰å¡ç‰‡å†å²

### ğŸ† æˆå°±ç³»ç»Ÿ
- **ä»»åŠ¡å®Œæˆ**: å®Œæˆä»»åŠ¡åå¼¹å‡ºåº†ç¥åŠ¨ç”»
- **æ˜Ÿæ˜Ÿå¥–åŠ±**: è·å¾—çš„æ˜Ÿæ˜Ÿä¼šå­˜å‚¨åœ¨å¾½ç« ç³»ç»Ÿä¸­
- **è¿›åº¦è¿½è¸ª**: è·Ÿè¸ªç©å®¶çš„æˆå°±è¿›åº¦

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

#### EventManager
ä¸»è¦çš„äº‹ä»¶ç®¡ç†ç»„ä»¶ï¼Œè´Ÿè´£ï¼š
- å¤„ç†å¡ç‰‡é€‰æ‹©å¯¹è¯æ¡†
- æ˜¾ç¤ºä»»åŠ¡å®Œæˆåº†ç¥
- ç®¡ç†å¡åŒ…ç•Œé¢
- æ˜¾ç¤ºæ‚¬æµ®é€šçŸ¥

#### CardChoiceModal
å¡ç‰‡é€‰æ‹©å¯¹è¯æ¡†ï¼Œç”¨äºï¼š
- å±•ç¤ºæ–°è§¦å‘çš„ä»»åŠ¡æˆ–äº‹ä»¶
- æä¾›æ¥å—/æ‹’ç»é€‰é¡¹
- æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯å’Œå¥–åŠ±

#### MyCards
å¡åŒ…ç®¡ç†ç•Œé¢ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š
- å±•ç¤ºæ‰€æœ‰æ”¶é›†çš„å¡ç‰‡
- æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤ºï¼ˆä»»åŠ¡/äº‹ä»¶ï¼‰
- æ˜¾ç¤ºå¡ç‰‡çŠ¶æ€å’Œè¿›åº¦

#### MissionCompletedModal
ä»»åŠ¡å®Œæˆåº†ç¥ç•Œé¢ï¼Œç‰¹æ€§ï¼š
- åŠ¨ç”»åº†ç¥æ•ˆæœ
- æ˜Ÿæ˜Ÿå¥–åŠ±å±•ç¤º
- è‡ªåŠ¨å…³é—­åŠŸèƒ½

### æœåŠ¡å±‚

#### EventManager Service
äº‹ä»¶ç®¡ç†æœåŠ¡ï¼Œæä¾›ï¼š
- éšæœºäº‹ä»¶å’Œä»»åŠ¡ç”Ÿæˆ
- è§¦å‘æ¡ä»¶æ£€æŸ¥
- å¡ç‰‡çŠ¶æ€ç®¡ç†
- ä»»åŠ¡å®Œæˆæ£€æŸ¥

### æ•°æ®ç»“æ„

#### PlayerCard
```typescript
interface PlayerCard {
  id: string;
  type: 'mission' | 'event';
  data: Mission | EventCard;
  obtainedAt: number; // è·å¾—çš„å¤©æ•°
  isNew?: boolean;
}
```

#### Mission (æ‰©å±•)
```typescript
interface Mission {
  id: number;
  title: string;
  background: string;
  tip: string;
  focus: string;
  rewardStars: number;
  status?: 'pending' | 'active' | 'completed' | 'declined';
  acceptedAt?: number;
  completedAt?: number;
  targetAssets?: string[];
  targetAllocation?: number;
}
```

#### EventCard (æ‰©å±•)
```typescript
interface EventCard {
  id: number;
  title: string;
  description: string;
  status?: 'pending' | 'active' | 'declined';
  acceptedAt?: number;
  duration?: number;
  effects?: {
    type: 'add' | 'mul' | 'volatility';
    value: number;
    targets: string[];
  };
}
```

## ä½¿ç”¨æ–¹æ³•

### é›†æˆåˆ°åº”ç”¨
```tsx
import { EventManager } from './components/EventManager';

function App() {
  return (
    <GameProvider>
      <MainScreen />
      <EventManager />
    </GameProvider>
  );
}
```

### è§¦å‘äº‹ä»¶
```typescript
const { triggerNewCards } = useGameState();

// åœ¨èµ„äº§é…ç½®åè§¦å‘
triggerNewCards('apply');

// åœ¨ä¸‹ä¸€å¤©è§¦å‘
triggerNewCards('nextDay');

// åˆå§‹åŒ–è§¦å‘
triggerNewCards('init');
```

### ç®¡ç†å¡ç‰‡
```typescript
const { acceptCard, declineCard, gameState } = useGameState();

// æ¥å—å¡ç‰‡
acceptCard(playerCard);

// æ‹’ç»å¡ç‰‡
declineCard(playerCard);

// æŸ¥çœ‹å¾…å¤„ç†å¡ç‰‡
const pendingCards = gameState.pendingCards;
```

## è§¦å‘æ¦‚ç‡é…ç½®

### ä»»åŠ¡è§¦å‘æ¦‚ç‡
- APPLY æ“ä½œ: 30%
- ä¸‹ä¸€å¤©: 20%
- åˆå§‹åŒ–: 10%

### äº‹ä»¶è§¦å‘æ¦‚ç‡
- APPLY æ“ä½œ: 25%
- ä¸‹ä¸€å¤©: 15%
- åˆå§‹åŒ–: 5%

## ä»»åŠ¡å®Œæˆæ¡ä»¶

æ¯ä¸ªä»»åŠ¡éƒ½æœ‰ç‰¹å®šçš„å®Œæˆæ¡ä»¶ï¼š

### é£é™©é›†ä¸­ (Concentration Risk)
- ç›®æ ‡èµ„äº§: é«˜é£é™©èµ„äº§ (sword, crystal)
- è¦æ±‚: å•ä¸€èµ„äº§åˆ†é…ä¸è¶…è¿‡40%

### ESGæŠ•èµ„ (ESG Investing)
- ç›®æ ‡èµ„äº§: ESGèµ„äº§ (forest)
- è¦æ±‚: ESGèµ„äº§åˆ†é…15-25%

### é¿é™©èµ„äº§ (Safe Haven Assets)
- ç›®æ ‡èµ„äº§: é¿é™©èµ„äº§ (golden, shield)
- è¦æ±‚: é¿é™©èµ„äº§åˆ†é…30-50%

### æµåŠ¨æ€§ç®¡ç† (Liquidity Management)
- ç›®æ ‡èµ„äº§: æµåŠ¨æ€§èµ„äº§ (fountain)
- è¦æ±‚: æµåŠ¨æ€§èµ„äº§åˆ†é…10-20%

### æ”¶ç›Šç­–ç•¥ (Yield Strategy)
- ç›®æ ‡èµ„äº§: æ”¶ç›Šèµ„äº§ (yield)
- è¦æ±‚: æ”¶ç›Šèµ„äº§åˆ†é…20-35%

## æ ·å¼å®šåˆ¶

æ‰€æœ‰ç»„ä»¶éƒ½åŒ…å«å®Œæ•´çš„CSSæ ·å¼ï¼Œæ”¯æŒï¼š
- å“åº”å¼è®¾è®¡
- æ·±è‰²ä¸»é¢˜
- åŠ¨ç”»æ•ˆæœ
- æ‚¬åœäº¤äº’

å¯ä»¥é€šè¿‡ä¿®æ”¹å¯¹åº”çš„CSSæ–‡ä»¶æ¥è‡ªå®šä¹‰å¤–è§‚ã€‚

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„ä»»åŠ¡ç±»å‹
1. åœ¨ `MISSIONS` æ•°æ®ä¸­æ·»åŠ æ–°ä»»åŠ¡
2. åœ¨ `generateMissionTargets` ä¸­å®šä¹‰ç›®æ ‡èµ„äº§
3. åœ¨ `generateTargetAllocation` ä¸­è®¾ç½®ç›®æ ‡åˆ†é…

### æ·»åŠ æ–°çš„äº‹ä»¶ç±»å‹
1. åœ¨ `SAMPLE_EVENTS` ä¸­æ·»åŠ æ–°äº‹ä»¶
2. å®šä¹‰äº‹ä»¶æ•ˆæœå’ŒæŒç»­æ—¶é—´
3. åœ¨ `generateRandomEvent` ä¸­å¤„ç†æ–°äº‹ä»¶é€»è¾‘

### è‡ªå®šä¹‰è§¦å‘æ¡ä»¶
1. ä¿®æ”¹ `TRIGGER_RATES` é…ç½®
2. åœ¨ `checkForNewCards` ä¸­æ·»åŠ æ–°çš„è§¦å‘é€»è¾‘
3. æ‰©å±• `EventTriggerContext` ç±»å‹å®šä¹‰